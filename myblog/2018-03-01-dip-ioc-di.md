# DIP/IOC/DI想法筆記

以A牌主機板跟顯示卡之間的關係說故事來說明。

---

## DIP(Dependency Inversion Principle) 依賴反轉

    現在A牌想設計一款與眾不同的主機板，內建顯示卡直接焊在主板上面，
    選了一家還不錯的廠商出的特規顯示卡，工程師針對它去設計相關的軔體；
    主機板賣的很好，要推出新款了，老闆因為原先顯示卡廠商的產能不夠，決定換一家的產品，
    所以工程師只好找了新的顯卡商，然後重新設計相關的軔體；
    新主機板賣的更好...接下來無限迴圈......工程師越來越多，全都在做同樣的事。

    後來老闆覺得這樣不行，成本越來越高了，
    終於決定改成用通用的顯示卡協定來設計新產品，
    於是，工程師很快重新做好了一個實作通用顯示卡協定的版本，
    找了多款通用的顯示卡，最後選了一款不錯的產品來使用；
    新新主機板又賣的很好，現在又要推出新新新款了，老闆因為原先顯示卡廠商的價格太高，想要costdown，
    於是工程師很愉快的找到了一款新的顯示卡，然後放上去就完成了，
    終於不用在重新寫一遍接顯示卡的軔體了(爽爽der)
    工程師終於可以有更多的時間去做嘿嘿嘿的事了(誤)；
    接下來無限迴圈......老闆嘿嘿嘿的砍掉了一堆原本新找進來接顯示卡的工程師(抖)。

故事說完了，來看看問題吧。

    **Q：A牌的原先設計方式發生了什麼問題？**

    它的每款主機板都使用各別廠商的特規產品，
    所以完全無法簡單抽換，要花很多時間跟成本來重做串接顯示卡的部份，一直在做同樣的事。

    **Q：新的設計方式有比較好嗎？**

    因為實作了通用的協定，所以後面的產品終於可以簡單的抽換了顯示卡了，
    不用在重做接顯示卡的部份，你沒看後面大家都在嘿嘿嘿了嗎?(誤)。

    **Q：這跟依賴有什麼關係？**

    1. 通用協定是抽象的，並不具體到各別廠商的實作內容。
    2. A牌的主機板嚴重依賴各別的特規產品，無法簡單抽換。
    3. 後來主機板廠改成了只依賴了通用協定，顯示卡廠也只依賴了通用協定，就可以快速抽換顯示卡了(讚喔)。

    **Q：到底反轉了什麼？**

    代號 A為主機板廠，B為顯示卡廠，P為協定
    1. 原先 A依賴B A->B
    2. 後來 A依賴P B也依賴P A->P<-B

    看到了嗎？箭頭反過來了(誤)
    好啦，其實這是一種思路的反轉，
    不再是由上而下，由原先的先設計主機板才決定零件長什麼樣，
    改成由下而上，先設計零件通用長成什麼樣(協定)，後才設計主機板去實作這個協定。

這就是依賴反轉。

---

## IOC(Inversion of Control) 控制反轉

    A牌主機板一直以來都是內建顯示卡，後來老闆發現新產品銷量下降很多，
    一看原來是老顧客者們覺得效能都不夠用，但又不能自己擴充，
    所以只好忍痛換了另一牌可以自己插卡的主機板，
    順應市場需求，所以老闆決定改成外部插卡式的了，方便顧客們自行選用喜愛的顯示卡來插，
    工程師就從直接焊板，改成焊個連結器來提供插卡功能，
    做好之後，除了主機板又賣的更好了之外，
    工程師還發現還有額外好處呢，
    以後想測試任何通用的顯示卡就不用重新焊板，只要插插插就完成了(爽爽der)

故事說完了，來看看問題吧。

    **Q：什麼是控制？**

    就是控制顯示卡由誰來決定的過程，
    1. 舊的主機板型號都是主機板生產時就控制是固定的顯示卡了，沒有選擇空間，也不好測試。
    2. 新的主機板型號改成讓使用者來控制說到底要使用什麼樣的顯示卡，彈性大，也更方便測試了呢！(工程師認證)
    3. 不管是外部的顯示卡還是內部的顯示卡都必須實作通用協定才能插來插去啊。

    **Q：反轉在哪？**

    由產品本身決定內容反轉到由外部使用者來決定。

這就是控制反轉。

---

## DI(Dependency Injection) 依賴注入

故事同上，直接看問題吧。

    **Q：什麼是依賴？**

    主機板只依賴了通用協定，外部顯示卡也依賴了通用協定，所以就可以快速抽換顯示卡了(讚喔)。

    **Q：注入是什麼？**

    產品使用外部插進來的卡片的內容來執行東西，注入其實就是插來插去插來插去的啊(污)。

這就是依賴注入。

---

## 題外話

    **Q：既然插插插這麼好，為什麼還有廠商要用內嵌的呢？**

    因為外插很容易出現沒預料到的情況，相比起來內嵌的問題都在可控範圍內，
    但這就要由老闆跟工程師來取捨了。

---
