# DIP/IOC/DI想法筆記

以A牌筆電跟記憶卡之間的關係說故事來說明。

---

## DIP(Dependency Inversion Principle) 依賴反轉

```txt
現在A牌想設計一款與眾不同的筆電，
內建記憶體直接焊在主板上面，選了一家還不錯的廠商出的特規記憶體，工程師針對它去設計相關的實作；
筆電賣的很好，要推出新款了，老闆因為原先記憶體廠商的產能不夠，決定換一家的產品，
所以工程師只好又重新的在找了一家做了同樣的流程；
新筆電賣的更好...接下來無限迴圈......工程師越來越多，全都在做同樣的事。
```

```txt
後來老闆覺得這樣不行，成本越來越高了，
終於決定改成用通用的記憶體協定來設計新產品，
於是，工程師很快重新做好了一個實作通用記憶體協定的版本，找了多款通用的記憶體，最後選了一款不錯的產品來使用；
新新筆電又賣的很好，現在又要推出新新新款了，老闆因為原先記憶體廠商的價格太高，想要costdown，
於是工程師很愉快的找到了一款新的記憶體，然後放上去就完成了，終於不用在重新寫一遍接記憶體的軔體了(爽爽der)
工程師終於可以有更多的時間去做嘿嘿嘿的事了(誤)；
接下來無限迴圈......老闆嘿嘿嘿的砍掉了一堆原本新找進來接記憶體的工程師了(抖)。
```

故事說完了，來看看問題吧。

```txt
Q：A牌的原先設計方式發生了什麼問題？
A：它的每款筆電都使用各別廠商的特規產品，所以完全無法簡單抽換，要花很多時間跟成本來做串接記憶體的部份，一直在做同樣的事。

Q：新的設計方式有比較好嗎？
A：因為實作了通用的協定，所以後面的產品終於可以簡單的抽換了記憶體了，不用在重做接記憶體的部份，你沒看後面大家都在嘿嘿嘿了嗎?(誤)。

Q：這跟依賴有什麼關係？
A：
1.通用協定是抽象的，並不具體到各別廠商的實作內容。
2.A牌的筆電嚴重依賴各別的特規產品，無法簡單抽換。
3.後來筆電廠改成了只依賴了通用協定，記憶體廠也只依賴了通用協定，就可以快速抽換記憶體了(讚喔)。

Q：到底反轉了什麼？
A：代號 A為筆電廠，B為記憶體廠，P為協定
原先 A依賴B A->B
後來 A依賴P B也依賴P A->P<-B
看到了嗎？箭頭反過來了(誤)
好啦，其實這是一種思路的反轉，
不再是由上而下，由原先的先設計筆電才決定零件長什麼樣，
改成由下而上，先設計零件通用長成什麼樣(協定)，後才設計筆電去實作這個協定。
```

這就是依賴反轉。

---

## IOC(Inversion of Control) 控制反轉

```txt
A牌筆電一直以來都是內建記憶體，後來老闆發現新產品銷量下降很多，
一看原來是老顧客者們覺得容量都不夠用，但又不能自己擴充，
所以只好忍痛換了另一牌可以自己插卡的筆電，
順應市場需求，所以老闆決定改成外部插卡式的了，方便顧客們自行選用喜愛的記憶卡來插，
工程師就從直接焊板，改成焊個連結器來提供插卡功能，做好之後，
除了筆電賣的更好了，還發現還有額好處呢，以後工程師想測試任何通用的記憶體就不用重新焊板了，只要插插插就完成了(爽爽der)
```

故事說完了，來看看問題吧。

```txt
Q：什麼是控制？
A：就是控制記憶體由誰來決定的過程啦，
1.舊的筆電型號都是筆電生產時就控制是固定的記憶體了，沒有選擇空間，也不好測試。
2.新的筆電型號改成讓使用者來控制說到底要使用什麼樣的記憶體，彈性大，也更方便測試了呢！(工程師認證)
3.不管是外部的記憶卡還是內部的記憶體都必須實作通用協定才能插來插去啊。

Q：反轉在哪？
A：由產品本身決定內容反轉到由外部使用者來決定。
```

這就是控制反轉。

---

## DI(Dependency Injection) 依賴注入

故事同上，直接看問題吧。

```txt
Q：什麼是依賴？
A：筆電只依賴了通用協定，外部記憶卡也依賴了通用協定，所以就可以快速抽換記憶體了(讚喔)。

Q：注入是什麼？
A：產品使用外部插進來的卡片的內容來執行東西，注入其實就是插來插去插來插去的啊(污)。
```

這就是依賴注入。

---

## 題外話

```txt
Q：既然插插插這麼好，為什麼還有廠商要用內嵌的呢？
A: 因為外插很容易出現沒預料到的情況，相比起來內嵌的問題都在可控範圍內，但這就要由老闆跟工程師來取捨了。
```